<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tournoi Anime</title>
  <script src="retour.js" defer></script>
  <link rel="stylesheet" href="retour.css">
  <link rel="stylesheet" href="personnages.css">
</head>

<body>

  <header>
    <h1>Tournoi All Time Anime</h1>
    <div class="container-retour">
      <button class="btn-retour">← Retour à l'accueil</button>
    </div>
    <div class="categories">
      <div class="category selected" data-category="all-time">All Time</div>
      <div class="category" data-category="shōnen">shōnen</div>
      <div class="category" data-category="shōjo">shōjo</div>
      <div class="category" data-category="seinen">seinen</div>
      <div class="category" data-category="kodomo">kodomo</div>
    </div>
    <div id="roundIndicator">Round 1</div>
  </header>

  <div class="card-container">
    <div class="card" id="card1"></div>
    <div class="card" id="card2"></div>
  </div>

  <script>

    // Données pour les différentes catégories
    const categoriesData = {
      "all-time": [
        { image: "Manga-Anime/OnePiece.jpg", title: "One Piece", description: "Manga le plus populaire au monde." },
        { image: "Manga-Anime/NarutoS.jpg", title: "Naruto Shippuden", description: "L'un des plus connus." },
        { image: "Manga-Anime/Dragon Ball Z.jpg", title: "Dragon Ball Z", description: "Description du Manga 3." },
        { image: "Manga-Anime/Fullmetal Alchemist Brotherhood.jpg", title: "Fullmetal Alchemist", description: "Description du Manga 4." },
        { image: "Manga-Anime/Death Note.jpg", title: "Death Note", description: "Description du Manga 4." },
        { image: "Manga-Anime/Hunter x Hunter.jpg", title: "Hunter x Hunter", description: "Description du Manga 4." },
        { image: "Manga-Anime/GTO.jpg", title: "GTO", description: "Description du Manga 4." },
        { image: "Manga-Anime/Snk.jpg", title: "Snk", description: "Description du Manga 4." },
        { image: "Manga-Anime/Bleach.jpg", title: "Bleach", description: "Description du Manga 4." },
        { image: "Manga-Anime/JoJo's Bizarre Adventure.jpg", title: "JoJo's Bizarre Adventure", description: "Description du Manga 4." },
        { image: "Manga-Anime/Fairy Tail.jpg", title: "Fairy Tail", description: "Description du Manga 4." },
        { image: "Manga-Anime/Slam Dunk.jpg", title: "Slam Dunk", description: "Description du Manga 4." },
        { image: "Manga-Anime/Kenshin le vagabond.jpg", title: "Kenshin le vagabond", description: "Description du Manga 4." },
        { image: "Manga-Anime/Les Chevaliers du Zodiaque.jpg", title: "Les Chevaliers du Zodiaque", description: "Description du Manga 4." },
        { image: "Manga-Anime/One-Punch Man.jpg", title: "One-Punch Man", description: "Description du Manga 4." },
        { image: "Manga-Anime/Ippo.jpg", title: "Ippo", description: "Description du Manga 4." },
        { image: "Manga-Anime/My Hero Academia.jpg", title: "My Hero Academia", description: "Description du Manga 4." },
        { image: "Manga-Anime/YuYu Hakusho.jpg", title: "YuYu Hakusho", description: "Description du Manga 4." },
        { image: "Manga-Anime/Eyeshield 21.jpg", title: "Eyeshield 21", description: "Description du Manga 4." },
        { image: "Manga-Anime/Détective Conan.jpg", title: "Détective Conan", description: "Description du Manga 4." },
        { image: "Manga-Anime/Ken le survivant.jpg", title: "Ken le survivant", description: "Description du Manga 4." },
        { image: "Manga-Anime/Soul Eater.jpg", title: "Soul Eater", description: "Description du Manga 4." },
        { image: "Manga-Anime/Hikaru no Go.jpg", title: "Hikaru no Go", description: "Description du Manga 4." },
        { image: "Manga-Anime/Assassination Classroom.jpg", title: "Assassination Classroom", description: "Description du Manga 4." },
        { image: "Manga-Anime/Neon Genesis Evangelion.jpg", title: "Neon Genesis Evangelion", description: "Description du Manga 4." },
        { image: "Manga-Anime/Shaman King.jpg", title: "Shaman King", description: "Description du Manga 4." },
        { image: "Manga-Anime/Black Butler.jpg", title: "Black Butler", description: "Description du Manga 4." },
        { image: "Manga-Anime/Blue Exorcist.jpg", title: "Blue Exorcist", description: "Description du Manga 4." },
        { image: "Manga-Anime/Seven Deadly Sins.jpg", title: "Seven Deadly Sins", description: "Description du Manga 4." },
        { image: "Manga-Anime/Gintama.jpg", title: "Gintama", description: "Description du Manga 4." },
        { image: "Manga-Anime/Jujutsu Kaisen.jpg", title: "Jujutsu Kaisen", description: "Description du Manga 4." },
        { image: "Manga-Anime/Yu-Gi-Oh!.jpg", title: "Yu-Gi-Oh!", description: "Description du Manga 4." },
        { image: "Manga-Anime/The Promised Neverland.jpg", title: "The Promised Neverland", description: "Description du Manga 4." },
        { image: "Manga-Anime/Chainsaw Man.jpg", title: "Chainsaw Man", description: "Description du Manga 4." },
        { image: "Manga-Anime/Beelzebub.jpg", title: "Beelzebub", description: "Description du Manga 4." },
        { image: "Manga-Anime/Demon Slayer.jpg", title: "Demon Slayer", description: "Description du Manga 4." },
        { image: "Manga-Anime/Magi : The Labyrinth of Magic.jpg", title: "Magi : The Labyrinth of Magic", description: "Description du Manga 4." },
        { image: "Manga-Anime/A Silent Voice.jpg", title: "A Silent Voice", description: "Description du Manga 4." },
        { image: "Manga-Anime/Haikyu.jpg", title: "Haikuy", description: "Description du Manga 4." },
        { image: "Manga-Anime/Black Clover.jpg", title: "Black Clover", description: "Description du Manga 4." },
        { image: "Manga-Anime/Kuroko no Basket.jpg", title: "Kuroko no Basket", description: "Description du Manga 4." },
        { image: "Manga-Anime/Radiant.jpg", title: "Radiant", description: "Description du Manga 4." },
        { image: "Manga-Anime/Food Wars.jpg", title: "Food Wars", description: "Description du Manga 4." },
        { image: "Manga-Anime/Pokémon.jpg", title: "Pokémon", description: "Description du Manga 4." },
        { image: "Manga-Anime/Beastars.jpg", title: "Beastars", description: "Description du Manga 4." },
        { image: "Manga-Anime/I'll.jpg", title: "I'll", description: "Description du Manga 4." },
        { image: "Manga-Anime/Tokyo Revengers.jpg", title: "Tokyo Revengers", description: "Description du Manga 4." },
        { image: "Manga-Anime/-AnimeMob Psycho 100.jpg", title: "Mob Psycho 100", description: "Description du Manga 4." },
        { image: "Manga-Anime/Alice in Borderland.jpg", title: "Alice in Borderland", description: "Description du Manga 4." },
        { image: "Manga-Anime/Noragami.jpg", title: "Noragami", description: "Description du Manga 4." },
        { image: "Manga-Anime/Code Geass.jpg", title: "Code Geass", description: "Description du Manga 4." },
        { image: "Manga-Anime/Love Is Wars.jpg", title: "Love Is Wars", description: "Description du Manga 4." },
        { image: "Manga-Anime/Tomodachi Game.jpg", title: "Tomodachi Game", description: "Description du Manga 4." },
        { image: "Manga-Anime/Classroom Of The Elite.jpg", title: "Classroom Of The Elite", description: "Description du Manga 4." },
        { image: "Manga-Anime/Fruit Basket.jpg", title: "Fruit Basket", description: "Description du Manga 4." },
        { image: "Manga-Anime/Inazuma Eleven.jpg", title: "Inazuma Eleven", description: "Description du Manga 4." },
        { image: "Manga-Anime/Blue Lock.jpg", title: "Blue Lock", description: "Description du Manga 4." },
        { image: "Manga-Anime/Kingdom.jpg", title: "Kingdom", description: "Description du Manga 4." },
        { image: "Manga-Anime/Tokyo Ghoul.jpg", title: "Tokyo Ghoul", description: "Description du Manga 4." },
        { image: "Manga-Anime/Oshi No Ko.jpg", title: "Oshi No Ko", description: "Description du Manga 4." },
        { image: "Manga-Anime/Devilman.jpg", title: "Devilman", description: "Description du Manga 4." },
        { image: "Manga-Anime/Fire Force.jpg", title: "Fire Force", description: "Description du Manga 4." },
        { image: "Manga-Anime/Dr.Stone.jpg", title: "Dr.Stone", description: "Description du Manga 4." },
        { image: "Manga-Anime/Berserk.jpg", title: "Berserk", description: "Description du Manga 4." },
      ],
      "shōnen": [
      { image: "Manga-Anime/Dragon Ball Z.jpg", title: "Dragon Ball Z", description: "" },
        { image: "Manga-Anime/OnePiece.jpg", title: "One Piece", description: "" },
        { image: "Manga-Anime/GTO.jpg", title: "GTO", description: "" },
        { image: "Manga-Anime/NarutoS.jpg", title: "Naruto Shippuden", description: "" },
        { image: "Manga-Anime/Death Note/.jpg", title: "Deat Note", description: "" },
        { image: "Manga-Anime/Demon Slayer.jpg", title: "Demon Slayer", description: "" },
        { image: "Manga-Anime/My Hero Academia.jpg", title: "My Hero Academia", description: "" },
        { image: "Manga-Anime/The Promised Neverland.jpg", title: "The Promised Neverland", description: "" },
        { image: "Manga-Anime/Chainsaw Man.jpg", title: "Chainsaw Man", description: "" },
        { image: "Manga-Anime/Fire Force.jpg", title: "Fire Force", description: "" },
        { image: "Manga-Anime/Soul Eater.jpg", title: "Soul Eater", description: "" },
        { image: "Manga-Anime/FullMetal Alchemist Brotherhood.jpg", title: "FullMetal Alchemist", description: "" },
        { image: "Manga-Anime/Hunter x Hunter.jpg", title: "Hunter x Hunter", description: "" },
        { image: "Manga-Anime/Bleach.jpg", title: "Bleach", description: "" },
        { image: "Manga-Anime/Fairy Tail.jpg", title: "Fairy Tail", description: "" },
        { image: "Manga-Anime/JoJo's Bizarre Adventure.jpg", title: "JoJo's Bizarre Adventure", description: "" },
        { image: "Manga-Anime/Tomodachi Game", title: "Tomodachi Game", description: "" },
        { image: "Manga-Anime/Gurren Lagann", title: "Gurren Lagann", description: "" },
        { image: "Manga-Anime/Noraga", title: "", description: "" },
        { image: "Manga-Anime/Albator 84", title: "Albator 84", description: "" },
        { image: "Manga-Anime/Overlord", title: "Overlord", description: "" },
        { image: "Manga-Anime/Samurai 7", title: "Samurai 7", description: "" },
        { image: "Manga-Anime/DanMachi", title: "DanMachi", description: "" },
        { image: "Manga-Anime/Trigun", title: "Trigun", description: "" },
        { image: "Manga-Anime/Charlotte", title: "Charlotte", description: "" },
        { image: "Manga-Anime/Gate", title: "Gate", description: "" },
        { image: "Manga-Anime/Seven Deadly Sins", title: "Seven Deadly Sins", description: "" },
        { image: "Manga-Anime/Gintama", title: "Gintama", description: "" },
        { image: "Manga-Anime/Eyeshield 21", title: "Eyeshield 21", description: "" },
        { image: "Manga-Anime/Yu-Gi-Oh!", title: "Yu-Gi-Oh!", description: "" },
        { image: "Manga-Anime/Classroom Of The Elite", title: "Classroom Of The Elite", description: "" },
        { image: "Manga-Anime/Kuroko no Baske", title: "Kuroko no Baske", description: "" },
      ],
      "shōjo": [
        { image: "Manga-Anime/Nana", title: "Nana", description: "" },
        { image: "Manga-Anime/Fruit Basket", title: "Fruit Basket", description: "" },
        { image: "Manga-Anime/Maid Sama", title: "Maid Sama", description: "" },
        { image: "Manga-Anime/Blue Spring Ride", title: "Blue Spring Ride", description: "" },
        { image: "Manga-Anime/Mon Histoire", title: "Mon Histoire", description: "" },
        { image: "Manga-Anime/Wolf Girl & Black Prince", title: "Wolf Girl & Black Prince", description: "" },
        { image: "Manga-Anime/Le Garçon d'à côté", title: "Le Garçon d'à côté ", description: "" },
        { image: "Manga-Anime/Sawako", title: "Swako", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
        { image: "Manga-Anime/", title: "", description: "" },
      ],
      "seinen": [
        { image: "Manga-Anime/Death Note", title: "Death Note", description: "" },
        { image: "Manga-Anime/Snk", title: "Snk", description: "" },
        { image: "Manga-Anime/Btooom!", title: "Btooom!", description: "" },
        { image: "Manga-Anime/Black Lagoon", title: "Black Lagoon", description: "" },
        { image: "Manga-Anime/Blue Exorcist", title: "Blue Exorcist", description: "" },
        { image: "Manga-Anime/Rainbow", title: "Rainbow", description: "" },
        { image: "Manga-Anime/Samurai Champloo", title: "Samurai Champloo", description: "" },
        { image: "Manga-Anime/Monster", title: "Monster", description: "" },
        { image: "Manga-Anime/High School of the Dead", title: "High School of the Dead", description: "" },
        { image: "Manga-Anime/Berserk", title: "Berserk", description: "" },
        { image: "Manga-Anime/Tokyo Ghoul", title: "Tokyo Ghoul", description: "" },
        { image: "Manga-Anime/Hellsing Ultimate", title: "Hellsing Ultimate", description: "" },
        { image: "Manga-Anime/Kingdom", title: "Kingdom", description: "" },
        { image: "Manga-Anime/20th Century Boys", title: "20th Century Boys", description: "" },
        { image: "Manga-Anime/Grand Blue", title: "Grand Blue", description: "" },
        { image: "Manga-Anime/Vagabond", title: "Vagabond", description: "" },
      ],
      "kodomo": [
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      { image: "Manga-Anime/", title: "", description: "" },
      ]};

      
// Fonction pour mélanger un tableau (Algorithme de Fisher-Yates)
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]]; // Échange les éléments
  }
}

// Variables du tournoi
let selectedCategory = "all-time";
let currentRound = [];
let winners = [];
let pairIndex = 0;
let roundNumber = 1;

// Sélection des éléments du DOM
const card1 = document.getElementById('card1');
const card2 = document.getElementById('card2');
const roundIndicator = document.getElementById('roundIndicator');
const categoryElements = document.querySelectorAll('.category');

// Mise à jour de l'indicateur de round
function updateRoundIndicator() {
  roundIndicator.textContent = `Round ${roundNumber} sur ${totalRounds} (${currentRound.length} participants)`;
}


//const fs = require('fs').promises; // Utilisation de fs.promises pour une gestion asynchrone


// Affiche la paire de mangas actuelle ou passe au round suivant
async function loadPair() {
  console.log("loadPair appelé, winners.length :", winners.length, "winners :", winners);
  if (pairIndex < currentRound.length - 1) {
    const leftManga = currentRound[pairIndex];
    const rightManga = currentRound[pairIndex + 1];
    card1.innerHTML = `
      <img src="${leftManga.image}" alt="${leftManga.title}">
      <div class="info">
        <h2>${leftManga.title}</h2>
        <p>${leftManga.description}</p>
      </div>
    `;
    card2.innerHTML = `
      <img src="${rightManga.image}" alt="${rightManga.title}">
      <div class="info">
        <h2>${rightManga.title}</h2>
        <p>${rightManga.description}</p>
      </div>
    `;
  } else {
    if (winners.length === 1) {
      console.log("Fin du tournoi atteinte, gagnant :", winners[0], "title :", winners[0].title);

      // Créer la structure JSON
      const nouvelElement = {
        id: Date.now(),
        details: {
          Pseudo: localStorage.pseudo || '',
          Age: localStorage.age,
          Anime: {
            Titre: winners[0].title , Cat:selectedCategory},
        }
      };
      console.log("nouvelElement créé :", JSON.stringify(nouvelElement, null, 2));

      // Envoyer la requête
      let responseMessage = 'Envoi en cours...';
      try {
        console.log("Tentative d'envoi des données :", nouvelElement);
        const response = await fetch('http://localhost:3000/ajouterElementJSON', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(nouvelElement)
        });

        if (!response.ok) {
          throw new Error(`Erreur HTTP ${response.status}`);
        }

        responseMessage = await response.text();
        console.log("Réponse du serveur :", responseMessage);
      } catch (error) {
        console.error("Erreur lors de l'envoi :", error);
        responseMessage = `Erreur lors de l'envoi : ${error.message}`;
      }

      // Mettre à jour le DOM après la requête
      document.body.innerHTML = `
        <div class="winner">
          <h1>Vainqueur Final</h1>
          <h2>${winners[0].title || 'Inconnu'}</h2>
          <img src="${winners[0].image || ''}" alt="${winners[0].title || 'Inconnu'}">
          <p>${winners[0].description || ''}</p>
          <p id="response">${responseMessage}</p>
        </div>
      `;
    } else {
      console.log("Passage au round suivant, currentRound.length :", currentRound.length);
      currentRound = winners;
      winners = [];
      pairIndex = 0;
      roundNumber++;
      shuffleArray(currentRound);
      updateRoundIndicator();
      loadPair();
    }
  }
}

// Fonction de choix de la carte gagnante
function chooseWinner(index) {
  winners.push(currentRound[pairIndex + index]);
  pairIndex += 2;
  loadPair();
}

// Rendre les cartes cliquables
card1.addEventListener('click', () => chooseWinner(0));
card2.addEventListener('click', () => chooseWinner(1));

// Gestion du changement de catégorie
categoryElements.forEach(elem => {
  elem.addEventListener('click', () => {
    categoryElements.forEach(e => e.classList.remove('selected'));
    elem.classList.add('selected');
    selectedCategory = elem.getAttribute('data-category');
    initializeTournament();
  });
});

// Initialisation du tournoi pour la catégorie sélectionnée
let totalRounds;

function initializeTournament() {
  if (categoriesData[selectedCategory]) {
    currentRound = [...categoriesData[selectedCategory]];
    // On s'assure que le nombre de participants est une puissance de 2 (8, 16, etc.)
    totalRounds = Math.log2(currentRound.length);
    shuffleArray(currentRound); // Mélange aléatoirement les participants
    winners = [];
    pairIndex = 0;
    roundNumber = 1;
    updateRoundIndicator();
    loadPair();
  } else {
    document.querySelector('.card-container').innerHTML = `<div class="winner"><h2>Aucun manga pour cette catégorie</h2></div>`;
  }
}



    // Lancement initial du tournoi
    initializeTournament();
  </script>

</body>
</html>
